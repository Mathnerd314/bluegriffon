<?xml version="1.0"?>

<!-- ***** BEGIN LICENSE BLOCK *****
   - Version: MPL 1.1/GPL 2.0/LGPL 2.1
   -
   - The contents of this file are subject to the Mozilla Public License Version
   - 1.1 (the "License"); you may not use this file except in compliance with
   - the License. You may obtain a copy of the License at
   - http://www.mozilla.org/MPL/
   -
   - Software distributed under the License is distributed on an "AS IS" basis,
   - WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License
   - for the specific language governing rights and limitations under the
   - License.
   -
   - The Original Code is Diavolo.
   -
   - The Initial Developer of the Original Code is
   - Disruptive Innovations SARL
   - Portions created by the Initial Developer are Copyright (C) 2006-2008
   - the Initial Developer. All Rights Reserved.
   -
   - Contributor(s):
   -   Daniel Glazman (glazman@disruptive-innovations.com), Original author
   -
   - Alternatively, the contents of this file may be used under the terms of
   - either the GNU General Public License Version 2 or later (the "GPL"), or
   - the GNU Lesser General Public License Version 2.1 or later (the "LGPL"),
   - in which case the provisions of the GPL or the LGPL are applicable instead
   - of those above. If you wish to allow use of your version of this file only
   - under the terms of either the GPL or the LGPL, and not to allow others to
   - use your version of this file under the terms of the MPL, indicate your
   - decision by deleting the provisions above and replace them with the notice
   - and other provisions required by the LGPL or the GPL. If you do not delete
   - the provisions above, a recipient may use your version of this file under
   - the terms of any one of the MPL, the GPL or the LGPL.
   -
   - ***** END LICENSE BLOCK ***** -->

<!DOCTYPE grammar [
 <!ATTLIST context id ID #IMPLIED>
]>

<grammar name="css">
  <deftokens>
    <deftoken regexp="s" name="whitespace"/>
    <deftoken regexp="comment" name="comment"/>

    <deftoken string="=" name="EQUALS"/>
    <deftoken string="~=" name="INCLUDES"/>
    <deftoken string="|=" name="DASHMATCH"/>
    <deftoken string="*=" name="STARMATCH"/>
    <deftoken string="^=" name="CIRCMATCH"/>
    <deftoken string="$=" name="DOLLARMATCH"/>
    <deftoken string="{" name="LBRACE"/>
    <deftoken string="+" name="PLUS"/>
    <deftoken string=">" name="GREATER"/>
    <deftoken string="~" name="TILDA"/>
    <deftoken string="," name="COMMA"/>
    <deftoken string="!" name="BANG"/>
    <deftoken string="}" name="RBRACE"/>
    <deftoken string=";" name="SEMICOLON"/>
    <deftoken string="|" name="VBAR"/>
    <deftoken string="." name="PERIOD"/>
    <deftoken string=":" name="COLON"/>
    <deftoken string="[" name="LBRACKET"/>
    <deftoken string="]" name="RBRACKET"/>
    <deftoken string=")" name="RPAREN"/>
    <deftoken string="/" name="SLASH"/>
    <deftoken string="*" name="STAR"/>

    <deftoken string="important" name="IMPORTANT"/>

    <deftoken regexp="dimension" name="DIMENSION"/>
    <deftoken regexp="percentage" name="PERCENTAGE"/>
    <deftoken regexp="num" name="NUMBER"/>
    <deftoken regexp="hashmatch" name="HASHMATCH"/>
    <deftoken regexp="atimport" name="IMPORT_SYM"/>
    <deftoken regexp="atpage" name="PAGE_SYM"/>
    <deftoken regexp="atmedia" name="MEDIA_SYM"/>
    <deftoken regexp="atcharset" name="CHARSET_SYM"/>
    <deftoken regexp="atnamespace" name="NAMESPACE_SYM"/>
    <deftoken regexp="atfontface" name="FONTFACE_SYM"/>
    <deftoken regexp="function" name="FUNCTION"/>
    <deftoken regexp="ident" name="IDENT"/>
    <deftoken string="&lt;!--" name="CDO"/>
    <deftoken string="--&gt;" name="CDC"/>
    <deftoken regexp="string" name="STRING"/>
    <deftoken string="url(" name="URI"/>
    <deftoken regexp="url" name="URL"/>
    <deftoken regexp="invalid" name="INVALID"/>
  </deftokens>
  <regexps>
    <option type="case-insensitive"/>

    <regexp name="s" value="[ \t\r\n\f\u00a0]+"/>
    <regexp name="h" value="[0-9a-f]"/>
    <regexp name="nonascii" value="[\200-\377]"/>
    <regexp name="unicode" value="\\{h}{1,6}(\r\n|[ \t\r\n\f])?"/>
    <regexp name="escape" value="{unicode}|\\[^\r\n\f0-9a-f]"/>
    <regexp name="nmstart" value="[_a-z]|{nonascii}|{escape}"/>
    <regexp name="nmchar" value="[_a-z0-9-]|{nonascii}|{escape}"/>
    <regexp name="string1" value='\"([^\n\r\f\\"]|\\{nl}|{escape})*\"'/>
    <regexp name="string2" value="\'([^\n\r\f\\']|\\{nl}|{escape})*\'"/>
    <regexp name="invalid1" value='\"([^\n\r\f\\"]|\\{nl}|{escape})*'/>
    <regexp name="invalid2" value="\'([^\n\r\f\\']|\\{nl}|{escape})*"/>

    <regexp name="comment" value="\/\*[^*]*\*+([^/*][^*]*\*+)*\/"/>
    <regexp name="ident" value="-?{nmstart}{nmchar}*"/>
    <regexp name="name" value="{nmchar}+"/>
    <regexp name="num" value="[0-9]*\.[0-9]+|[0-9]+"/>
    <regexp name="string" value="{string1}|{string2}"/>
    <regexp name="invalid" value="{invalid1}|{invalid2}"/>
    <regexp name="url" value="([!#$%&amp;*-~]|{nonascii}|{escape})+"/>
    <regexp name="w" value="{s}?"/>
    <regexp name="nl" value="\n|\r\n|\r|\f"/>

    <regexp name="A" value="a|\\0{0,4}(41|61)(\r\n|[ \t\r\n\f])?"/>
    <regexp name="C" value="c|\\0{0,4}(43|63)(\r\n|[ \t\r\n\f])?"/>
    <regexp name="D" value="d|\\0{0,4}(44|64)(\r\n|[ \t\r\n\f])?"/>
    <regexp name="E" value="e|\\0{0,4}(45|65)(\r\n|[ \t\r\n\f])?"/>
    <regexp name="F" value="f|\\0{0,4}(46|66)(\r\n|[ \t\r\n\f])?"/>
    <regexp name="G" value="g|\\0{0,4}(47|67)(\r\n|[ \t\r\n\f])?|\\g"/>
    <regexp name="H" value="h|\\0{0,4}(48|68)(\r\n|[ \t\r\n\f])?|\\h"/>
    <regexp name="I" value="i|\\0{0,4}(49|69)(\r\n|[ \t\r\n\f])?|\\i"/>
    <regexp name="J" value="j|\\0{0,4}(4a|6a)(\r\n|[ \t\r\n\f])?|\\i"/>
    <regexp name="K" value="k|\\0{0,4}(4b|6b)(\r\n|[ \t\r\n\f])?|\\k"/>
    <regexp name="L" value="l|\\0{0,4}(4c|6c)(\r\n|[ \t\r\n\f])?|\\k"/>
    <regexp name="M" value="m|\\0{0,4}(4d|6d)(\r\n|[ \t\r\n\f])?|\\m"/>
    <regexp name="N" value="n|\\0{0,4}(4e|6e)(\r\n|[ \t\r\n\f])?|\\n"/>
    <regexp name="O" value="o|\\0{0,4}(4f|6f)(\r\n|[ \t\r\n\f])?|\\o"/>
    <regexp name="P" value="p|\\0{0,4}(50|70)(\r\n|[ \t\r\n\f])?|\\p"/>
    <regexp name="Q" value="q|\\0{0,4}(51|71)(\r\n|[ \t\r\n\f])?|\\q"/>
    <regexp name="R" value="r|\\0{0,4}(52|72)(\r\n|[ \t\r\n\f])?|\\r"/>
    <regexp name="S" value="s|\\0{0,4}(53|73)(\r\n|[ \t\r\n\f])?|\\s"/>
    <regexp name="T" value="t|\\0{0,4}(54|74)(\r\n|[ \t\r\n\f])?|\\t"/>
    <regexp name="U" value="u|\\0{0,4}(55|75)(\r\n|[ \t\r\n\f])?|\\u"/>
    <regexp name="V" value="v|\\0{0,4}(56|76)(\r\n|[ \t\r\n\f])?|\\v"/>
    <regexp name="W" value="w|\\0{0,4}(57|77)(\r\n|[ \t\r\n\f])?|\\w"/>
    <regexp name="X" value="x|\\0{0,4}(58|78)(\r\n|[ \t\r\n\f])?|\\x"/>
    <regexp name="Y" value="y|\\0{0,4}(59|79)(\r\n|[ \t\r\n\f])?|\\y"/>
    <regexp name="Z" value="z|\\0{0,4}(5a|7a)(\r\n|[ \t\r\n\f])?|\\z"/>


    <regexp name="hashmatch" value="#{name}"/>

    <regexp name="atimport" value="@{I}{M}{P}{O}{R}{T}"/>
    <regexp name="atpage"   value="@{P}{A}{G}{E}"/>
    <regexp name="atmedia"  value="@{M}{E}{D}{I}{A}"/>
    <regexp name="atcharset" value="@{C}{H}{A}{R}{S}{E}{T}"/>
    <regexp name="atnamespace" value="@{N}{A}{M}{E}{S}{P}{A}{C}{E}"/>
    <regexp name="atfontface" value="@{F}{O}{N}{T}-{F}{A}{C}{E}"/>

    <regexp name="dimension" value="(\+|\-)?{num}{ident}"/>

    <regexp name="percentage" value="(\+|\-)?{num}%"/>

    <regexp name="function" value="{ident}\("/>
  </regexps>

  <styleset>
    <style role="CDO"                   value="font-style: italic"/>
    <style role="CDC"                   value="font-style: italic"/>
    <style role="property"              value="color: red"/>
    <style role="value"                 value="color: #0000cd"/>
    <style role="begin-pseudo-selector" value="color: #336666"/>
    <style role="end-pseudo-selector"   value="color: #336666"/>
    <style role="colon-pseudo"          value="color: #336666"/>
    <style role="pseudo-selector"       value="color: #336666"/>
    <style role="funcnotation-value"    value="color: #cc33cc"/>
    <style role="class-selector"        value="color: #ff6600"/>
    <style role="period-class"          value="color: #ff6600"/>
    <style role="attribute-name"        value="color: #666666"/>
    <style role="attribute-value"       value="color: #cc33cc"/>
    <style role="value" forToken="STRING" value="color: #cc33cc"/>
    <style role="attribute-name"        value="color: #666666"/>
    <style role="open-bracket"          value="color: #666666"/>
    <style role="close-bracket"         value="color: #666666"/>
    <style role="type"                  value="color: #993200"/>
    <style role="namespace"             value="color: #993399"/>
    <style role="ID"                    value="color: #772100"/>
    <style role="comment"               value="color: #009900"/>
    <style role="media"                 value="color: rgb(204,102,0)"/>
    <style role="at-media"              value="color: rgb(51,102,102)"/>
    <style role="at-charset"            value="color: rgb(51,102,102)"/>
    <style role="at-fontface"           value="color: rgb(51,102,102)"/>
    <style role="at-import"             value="color: rgb(51,102,102)"/>
    <style role="at-namespace"          value="color: rgb(51,102,102)"/>
    <style role="at-page"               value="color: rgb(51,102,102)"/>
    <style role="url-call"              value="color: #009900"/>
    <style role="function-call"         value="color: #009900"/>
    <style role="url-value" forToken="STRING" value="color: #cc33cc"/>
    <style role="url-value" forToken="URL"    value="color: #aa11aa"/>
    <style role="importance"            value="font-style: italic"/>
  
    <errorstyle     value="border-bottom: red dotted 1px;"/>
    <skipuntilstyle value="border-bottom: lime dotted 1px;"/>
  </styleset>

  <contexts>
    
    <!-- START OF STYLESHEET, CDO STILL POSSIBLE -->
    <context id="INIT0">
      <error skipuntil="RBRACE" expecting="INIT"/>
      <ignore>
        <type name="whitespace" />
        <type name="comment" />
      </ignore>
      <token type="CDO" role="cdo" expecting="INIT"/>

      <token type="CHARSET_SYM"                 role="at-charset"   expecting="charset-rule-descriptor"/>
      <token type="IMPORT_SYM"                  role="at-import"    expecting="import-rule-descriptor"/>
      <token type="MEDIA_SYM"                   role="at-media"     expecting="media-rule-descriptor"/>
      <token type="NAMESPACE_SYM"               role="at-namespace" expecting="namespace-rule-descriptor"/>
      <token type="PAGE_SYM"                    role="at-page"      expecting="page-rule-descriptor"/>
      <token type="FONTFACE_SYM"                role="at-fontface"  expecting="fontFace-rule-descriptor"/>
    
      <token type="IDENT"  lookahead="VBAR"     role="namespace" expecting="namespace-separator"/>
      <token type="IDENT"                       role="type"      expecting="selector-context1"/>
      <token type="STAR"   lookahead="VBAR"     role="namespace" expecting="namespace-separator"/>
      <token type="STAR"                        role="type"      expecting="selector-context1"/>
      <token type="VBAR"                        role="vbar"      expecting="element-name"/>
      <token type="COLON"                       role="colon-pseudo" expecting="pseudo-selector"/>
      <token type="PERIOD"                      role="period-class" expecting="class-selector"/>
      <token type="LBRACKET"                    role="openbracket" expecting="attribute-selector"/>
      <token type="HASHMATCH"                   role="ID"        expecting="selector-context1"/>
    </context>
    
    <!-- START OF STYLESHEET, CDO ALREADY FOUND -->
    <context id="INIT">
      <error skipuntil="RBRACE" expecting="INIT"/>
      <ignore>
        <type name="whitespace" />
        <type name="comment" />
      </ignore>
      <token type="CHARSET_SYM"                 role="at-charset"   expecting="charset-rule-descriptor"/>
      <token type="IMPORT_SYM"                  role="at-import"    expecting="import-rule-descriptor"/>
      <token type="MEDIA_SYM"                   role="at-media"     expecting="media-rule-descriptor"/>
      <token type="NAMESPACE_SYM"               role="at-namespace" expecting="namespace-rule-descriptor"/>
      <token type="PAGE_SYM"                    role="at-page"      expecting="page-rule-descriptor"/>
      <token type="FONTFACE_SYM"                role="at-fontface"  expecting="fontFace-rule-descriptor"/>
    
      <token type="IDENT"  lookahead="VBAR"     role="namespace" expecting="namespace-separator"/>
      <token type="IDENT"                       role="type"      expecting="selector-context1"/>
      <token type="STAR"   lookahead="VBAR"     role="namespace" expecting="namespace-separator"/>
      <token type="STAR"                        role="type"      expecting="selector-context1"/>
      <token type="VBAR"                        role="vbar"      expecting="element-name"/>
      <token type="COLON"                       role="colon-pseudo" expecting="pseudo-selector"/>
      <token type="PERIOD"                      role="period-class" expecting="class-selector"/>
      <token type="LBRACKET"                    role="openbracket" expecting="attribute-selector"/>
      <token type="HASHMATCH"                   role="ID"        expecting="selector-context1"/>
    
      <token type="CDC" role="cdc" />
    
    </context>
    
    <!-- @charset at-rule -->
    
    <context id="charset-rule-descriptor">
      <error skipuntil="SEMICOLON" expecting="INIT"/>
       <ignore>
        <type name="whitespace" />
        <type name="comment" />
      </ignore>
      <token type="STRING" role="charset" expecting="end-at-rule"/>
    </context>
    
    <context id="end-at-rule">
      <error skipuntil="SEMICOLON" expecting="INIT"/>
      <ignore>
        <type name="whitespace" />
        <type name="comment" />
      </ignore>
      <token type="SEMICOLON" role="semicolon" expecting="INIT"/>
    </context>
    
    <!-- ============================================= -->
    <!-- IMPORT AT-RULE -->
    <!-- ============================================= -->
    
    <context id="import-rule-descriptor">
      <error skipuntil="SEMICOLON" expecting="INIT"/>
      <ignore>
        <type name="whitespace" />
        <type name="comment" />
      </ignore>
      <token type="STRING" role="imported-url" expecting="import-rule-part2"/>
      <token type="URI"    role="url-call"     expecting="import-rule-url-value"/>
    </context>

    <context id="import-rule-url-value">
      <error skipuntil="SEMICOLON" expecting="INIT"/>
      <ignore>
        <type name="whitespace" />
        <type name="comment" />
      </ignore>
      <token type="STRING" role="url-value" expecting="import-rule-url-rparen"/>
      <token type="URL"    role="url-value" expecting="import-rule-url-rparen"/>
    </context>

    <context id="import-rule-url-rparen">
      <error skipuntil="SEMICOLON" expecting="INIT"/>
      <ignore>
        <type name="whitespace" />
        <type name="comment" />
      </ignore>
      <token type="RPAREN" role="url-call" expecting="import-rule-part2"/>
    </context>


    <context id="import-rule-part2">
      <error skipuntil="SEMICOLON" expecting="INIT"/>
      <ignore>
        <type name="whitespace" />
        <type name="comment" />
      </ignore>
      <token type="SEMICOLON" role="semicolon" expecting="INIT"/>
      <token type="IDENT"     role="media" expecting="import-rule-part3"/>
    </context>

    <context id="import-rule-part3">
      <error skipuntil="SEMICOLON" expecting="INIT"/>
      <ignore>
        <type name="whitespace" />
        <type name="comment" />
      </ignore>
      <token type="COMMA" role="comma" expecting="import-rule-part2"/>
    </context>
    
    <!-- ============================================= -->
    <!-- NAMESPACE AT-RULE -->
    <!-- ============================================= -->
    
    <context id="namespace-rule-descriptor">
      <error skipuntil="SEMICOLON" expecting="INIT"/>
      <ignore>
        <type name="whitespace" />
        <type name="comment" />
      </ignore>
      <token type="URI"   role="url-call" expecting="namespace-rule-url-value"/>
      <token type="IDENT" role="namespace" expecting="namespace-rule-context1"/>
    </context>

    <context id="namespace-rule-url-value">
      <error skipuntil="SEMICOLON" expecting="INIT"/>
      <ignore>
        <type name="whitespace" />
        <type name="comment" />
      </ignore>
      <token type="STRING"  role="url-value" expecting="namespace-rule-url-rparen"/>
      <token type="URL"     role="url-value" expecting="namespace-rule-url-rparen"/>
    </context>

    <context id="namespace-rule-url-rparen">
      <error skipuntil="SEMICOLON" expecting="INIT"/>
      <ignore>
        <type name="whitespace" />
        <type name="comment" />
      </ignore>
      <token type="RPAREN"  role="url-call" expecting="end-at-rule"/>
    </context>

    <context id="namespace-rule-context1">
      <error skipuntil="SEMICOLON" expecting="INIT"/>
      <ignore>
        <type name="whitespace" />
        <type name="comment" />
      </ignore>
      <token type="URI"   role="url-call" expecting="namespace-rule-url-value"/>
    </context>
    
    <!-- ============================================= -->
    <!-- PAGE AT-RULE -->
    <!-- ============================================= -->
    
    <context id="page-rule-descriptor">
      <error skipuntil="RBRACE" expecting="INIT"/>
      <ignore>
        <type name="whitespace" />
        <type name="comment" />
      </ignore>
      <token type="IDENT"       role="page-selector" expecting="open-page-block"/>
      <token type="COLON"       role="colon-pseudo"  expecting="page-pseudo"/>
      <token type="LBRACE"      role="openbrace"     expecting="declaration-context1"/>
    </context>
    
    <context id="open-page-block">
      <error skipuntil="RBRACE" expecting="INIT"/>
      <ignore>
        <type name="whitespace" />
        <type name="comment" />
      </ignore>
      <token type="LBRACE" role="openbrace" expecting="declaration-context1"/>
    </context>
    
    <context id="page-pseudo">
      <error skipuntil="RBRACE" expecting="INIT"/>
      <ignore>
        <type name="comment" />
      </ignore>
      <token type="IDENT" role="page-selector" expecting="open-page-block"/>
    </context>
    
    <!-- ============================================= -->
    <!-- FONT-FACE AT-RULE -->
    <!-- ============================================= -->
    
    <context id="fontFace-rule-descriptor">
      <error skipuntil="RBRACE" expecting="INIT"/>
      <ignore>
        <type name="whitespace" />
        <type name="comment" />
      </ignore>
      <token type="LBRACE" role="openbrace" expecting="declaration-context1"/>
    </context>
    
    <!-- ============================================= -->
    <!-- SELECTORS -->
    <!-- ============================================= -->
    
    <context id="namespace-separator">
      <error skipuntil="RBRACE" expecting="INIT"/>
      <ignore>
        <type name="comment" />
      </ignore>
      <token type="VBAR" role="vbar" expecting="element-name"/>
    </context>
    
    <context id="element-name">
      <error skipuntil="RBRACE" expecting="INIT"/>
      <ignore>
        <type name="comment" />
      </ignore>
      <token type="STAR"  role="type" expecting="selector-context1"/>
      <token type="IDENT" role="type"         expecting="selector-context1"/>
    </context>
    
    <context id="pseudo-selector">
      <error skipuntil="RBRACE" expecting="INIT"/>
      <token type="COLON"    role="colon-pseudo"    expecting="pseudo-selector2"/>
      <token type="FUNCTION" role="pseudo-selector" expecting="funcnotation-value2"/>
      <token type="IDENT"    role="pseudo-selector" expecting="selector-context1"/>
    </context>
    
    <context id="pseudo-selector2">
      <error skipuntil="RBRACE" expecting="INIT"/>
      <token type="IDENT"    role="pseudo-selector" expecting="selector-context1"/>
    </context>
    
    <context id="funcnotation-value2">
      <error skipuntil="RBRACE" expecting="INIT"/>
      <ignore>
        <type name="whitespace" />
        <type name="comment" />
      </ignore>
      <token type="RPAREN" role="end-pseudo-selector" expecting="selector-context1"/>
      <token type=""       role="funcnotation-value" expecting="funcnotation-value2"/>
    </context>
    
    <context id="class-selector">
      <error skipuntil="RBRACE" expecting="INIT"/>
      <token type="IDENT" role="class-selector" expecting="selector-context1"/>
    </context>
    
    <context id="attribute-selector">
      <error skipuntil="RBRACE" expecting="INIT"/>
      <ignore>
        <type name="whitespace" />
        <type name="comment" />
      </ignore>

      <token type="IDENT"  lookahead="VBAR"     role="namespace" expecting="attr-namespace-separator"/>
      <token type="IDENT"                       role="attribute-name" expecting="attribute-context1"/>

      <token type="STAR"   lookahead="VBAR"     role="namespace" expecting="attr-namespace-separator"/>
      <token type="VBAR"                        role="vbar"      expecting="attr-namespace-attrname"/>
    </context>

    <context id="attr-namespace-separator">
      <error skipuntil="RBRACE" expecting="INIT"/>

      <token type="VBAR" role="vbar" expecting="attr-namespace-attrname"/>
    </context>

    <context id="attr-namespace-attrname">
      <error skipuntil="RBRACE" expecting="INIT"/>

      <token type="IDENT" role="attribute-name" expecting="attribute-context1"/>
    </context>

    <context id="attribute-context1">
      <error skipuntil="RBRACE" expecting="INIT"/>
      <ignore>
        <type name="whitespace" />
        <type name="comment" />
      </ignore>
      <token type="RBRACKET"      role="closebracket"       expecting="selector-context1"/>
      <token type="EQUALS"        role="attribute-matching" expecting="attribute-value"/>
      <token type="INCLUDES"      role="attribute-matching" expecting="attribute-value"/>
      <token type="DASHMATCH"     role="attribute-matching" expecting="attribute-value"/>
      <token type="CIRCMATCH"     role="attribute-matching" expecting="attribute-value"/>
      <token type="DOLLARMATCH"   role="attribute-matching" expecting="attribute-value"/>
      <token type="STARMATCH"     role="attribute-matching" expecting="attribute-value"/>
    </context>
    
    <context id="attribute-value">
      <error skipuntil="RBRACE" expecting="INIT"/>
      <ignore>
        <type name="whitespace" />
        <type name="comment" />
      </ignore>
      <token type="IDENT"  role="attribute-value" expecting="end-attribute-selector"/>
      <token type="STRING" role="attribute-value" expecting="end-attribute-selector"/>
    </context>
    
    <context id="end-attribute-selector">
      <error skipuntil="RBRACE" expecting="INIT"/>
      <ignore>
        <type name="whitespace" />
        <type name="comment" />
      </ignore>
      <token type="RBRACKET"  role="closebracket"       expecting="selector-context1"/>
    </context>
    
    <context id="selector-context1">
      <error skipuntil="RBRACE" expecting="INIT"/>
      <ignore>
        <type name="comment" />
      </ignore>
    
      <token type="whitespace"                      expecting="selector-context2"/>
      <token type="GREATER"     role="combinator"   expecting="selector-context3"/>
      <token type="PLUS"        role="combinator"   expecting="selector-context3"/>
      <token type="TILDA"       role="combinator"   expecting="selector-context3"/>
    
      <token type="LBRACE"      role="openbrace"    expecting="declaration-context1"/>
      <token type="COMMA"       role="grouping"     expecting="selector-context3"/>
    
      <token type="COLON"       role="colon-pseudo" expecting="pseudo-selector"/>
      <token type="PERIOD"      role="period-class" expecting="class-selector"/>
      <token type="LBRACKET"    role="openbracket"  expecting="attribute-selector"/>
      <token type="HASHMATCH"   role="ID"           expecting="selector-context1"/>
    </context>
    
    <context id="selector-context2">
      <error skipuntil="RBRACE" expecting="INIT"/>
      <ignore>
        <type name="whitespace" />
        <type name="comment" />
      </ignore>
    
      <token type="GREATER"     role="combinator"   expecting="selector-context3"/>
      <token type="PLUS"        role="combinator"   expecting="selector-context3"/>
      <token type="TILDA"       role="combinator"   expecting="selector-context3"/>
      <token type="LBRACE"      role="openbrace"    expecting="declaration-context1"/>
    
      <token type="IDENT"  lookahead="VBAR"     role="namespace" expecting="namespace-separator"/>
      <token type="IDENT"                       role="type"      expecting="selector-context1"/>
      <token type="STAR"   lookahead="VBAR"     role="type"      expecting="namespace-separator"/>
      <token type="STAR"                        role="type"      expecting="selector-context1"/>
      <token type="VBAR"                        role="vbar"      expecting="element-name"/>
      <token type="COLON"                       role="colon-pseudo" expecting="pseudo-selector"/>
      <token type="PERIOD"                      role="period-class" expecting="class-selector"/>
      <token type="LBRACKET"                    role="openbracket" expecting="attribute-selector"/>
      <token type="HASHMATCH"                   role="ID"        expecting="selector-context1"/>
    </context>
    
    <context id="selector-context3">
      <error skipuntil="RBRACE" expecting="INIT"/>
      <ignore>
        <type name="whitespace" />
        <type name="comment" />
      </ignore>
    
      <token type="IDENT"  lookahead="VBAR"     role="namespace" expecting="namespace-separator"/>
      <token type="IDENT"                       role="type"      expecting="selector-context1"/>
      <token type="STAR"   lookahead="VBAR"     role="namespace" expecting="namespace-separator"/>
      <token type="STAR"                        role="type"      expecting="selector-context1"/>
      <token type="VBAR"                        role="vbar"      expecting="element-name"/>
      <token type="COLON"                       role="colon-pseudo" expecting="pseudo-selector"/>
      <token type="PERIOD"                      role="period-class" expecting="class-selector"/>
      <token type="LBRACKET"                    role="openbracket" expecting="attribute-selector"/>
      <token type="HASHMATCH"                   role="ID"        expecting="selector-context1"/>
    </context>
    
    <!-- ============================================= -->
    <!-- DECLARATIONS -->
    <!-- ============================================= -->
    
    <context id="declaration-context1">
      <error skipuntil="SEMICOLON" expecting="declaration-context1"/>
      <error skipuntil="RBRACE"    expecting="INIT"/>
      <ignore>
        <type name="whitespace" />
        <type name="comment" />
      </ignore>
      <token type="SEMICOLON"    role="semicolon" expecting="declaration-context1"/>
      <token type="IDENT"        role="property"  expecting="declaration-separator"/>
      <token type="RBRACE"       role="closebrace" expecting="INIT"/>
    </context>
    
    <context id="declaration-separator">
      <error skipuntil="SEMICOLON" expecting="declaration-context1"/>
      <error skipuntil="RBRACE"    expecting="INIT"/>
      <ignore>
        <type name="whitespace" />
        <type name="comment" />
      </ignore>
      <token type="COLON"  role="colon" expecting="declaration-value1"/>
    </context>
    
    <context id="declaration-value1">
      <error skipuntil="RBRACE"    expecting="INIT"/>
      <error skipuntil="SEMICOLON" expecting="declaration-context1"/>
      <ignore>
        <type name="whitespace" />
        <type name="comment" />
      </ignore>
      <token type="PERCENTAGE" role="value" expecting="declaration-value2"/>
      <token type="DIMENSION"  role="value" expecting="declaration-value2"/>
      <token type="NUMBER"     role="value" expecting="declaration-value2"/>
      <token type="HASHMATCH"  role="value" expecting="declaration-value2"/>
      <token type="URI"        role="url-call" expecting="declaration-url-value"/>
      <token type="STRING"     role="value" expecting="declaration-value2"/>
      <token type="FUNCTION"   role="function-call" expecting="function-value2"/>
      <token type="IDENT"      role="value" expecting="declaration-value2"/>
    </context>

    <context id="declaration-url-value">
      <ignore>
        <type name="whitespace" />
        <type name="comment" />
      </ignore>
      <token type="STRING"  role="url-value" expecting="declaration-rule-url-rparen"/>
      <token type="URL"     role="url-value" expecting="declaration-rule-url-rparen"/>
    </context>

    <context id="declaration-rule-url-rparen">
      <ignore>
        <type name="whitespace" />
        <type name="comment" />
      </ignore>
      <token type="RPAREN"  role="url-call" expecting="declaration-value2"/>
    </context>
    
    <context id="declaration-value2">
      <error skipuntil="RBRACE"    expecting="INIT"/>
      <error skipuntil="SEMICOLON" expecting="declaration-context1"/>
      <ignore>
        <type name="whitespace" />
        <type name="comment" />
      </ignore>
      <token type="SEMICOLON"  role="semicolon" expecting="declaration-context1"/>
      <token type="RBRACE"     role="closebrace" expecting="INIT"/>
    
      <token type="SLASH"      role="slash" expecting="declaration-value1"/>
      <token type="COMMA"      role="valuedelimiter" expecting="declaration-value1"/>
    
      <token type="BANG"       role="bang"  expecting="declaration-importance"/>
    
      <token type="PERCENTAGE" role="value" expecting="declaration-value2"/>
      <token type="DIMENSION"  role="value" expecting="declaration-value2"/>
      <token type="NUMBER"     role="value" expecting="declaration-value2"/>
      <token type="HASHMATCH"  role="value" expecting="declaration-value2"/>
      <token type="URI"        role="url-call" expecting="declaration-url-value"/>
      <token type="STRING"     role="value" expecting="declaration-value2"/>
      <token type="FUNCTION"   role="function-call" expecting="function-value2"/>
      <token type="IDENT"      role="value" expecting="declaration-value2"/>
    </context>
    
    <context id="declaration-importance">
      <error skipuntil="RBRACE"    expecting="INIT"/>
      <error skipuntil="SEMICOLON" expecting="declaration-context1"/>
      <ignore>
        <type name="whitespace" />
        <type name="comment" />
      </ignore>
    
      <token type="IMPORTANT" role="importance" expecting="declaration-end"/>
    </context>
    
    <context id="declaration-end">
      <error skipuntil="RBRACE"    expecting="INIT"/>
      <ignore>
        <type name="whitespace" />
        <type name="comment" />
      </ignore>
    
      <token type="SEMICOLON"  role="semicolon" expecting="declaration-context1"/>
    </context>
    
    <context id="function-value2">
      <error skipuntil="RBRACE"    expecting="INIT"/>
      <error skipuntil="SEMICOLON" expecting="declaration-context1"/>
      <ignore>
        <type name="whitespace" />
        <type name="comment" />
      </ignore>
      <token type="RPAREN" role="function-call"  expecting="declaration-value2"/>
      <token type=""       role="function-value" expecting="function-value2"/>
    </context>

  </contexts>

  <!-- ============================================= -->
  <!-- MEDIA AT-RULE -->
  <!-- ============================================= -->
  
  <context id="media-rule-descriptor">
    <ignore>
      <type name="whitespace" />
      <type name="comment" />
    </ignore>
    <token type="IDENT" role="media" expecting="media-context1"/>
  </context>
  
  <context id="media-context1">
    <ignore>
      <type name="whitespace" />
      <type name="comment" />
    </ignore>
    <token type="LBRACE"    role="openbrace" expecting="style-rule-only"/>
    <token type="COMMA"     role="grouping"  expecting="media-rule-descriptor"/>
  </context>
  
  <context id="style-rule-only">
    <error skipuntil="RBRACE" expecting="style-rule-only"/>
    <ignore>
      <type name="whitespace" />
      <type name="comment" />
    </ignore>
    <token type="IDENT"  lookahead="VBAR"     role="namespace" expecting="M-namespace-separator"/>
    <token type="IDENT"                       role="type"      expecting="M-selector-context1"/>
    <token type="STAR"   lookahead="VBAR"     role="namespace" expecting="M-namespace-separator"/>
    <token type="STAR"                        role="type"      expecting="M-selector-context1"/>
    <token type="VBAR"                        role="vbar"      expecting="M-element-name"/>
    <token type="COLON"                       role="colon-pseudo" expecting="M-pseudo-selector"/>
    <token type="PERIOD"                      role="period-class" expecting="M-class-selector"/>
    <token type="LBRACKET"                    role="openbracket" expecting="M-attribute-selector"/>
    <token type="HASHMATCH"                   role="ID"        expecting="M-selector-context1"/>
  
    <token type="RBRACE"                      role="closebrace" expecting="INIT"/>
  
  </context>
  
  <!-- ============================================= -->
  <!-- SELECTORS IN MEDIA AT-RULE -->
  <!-- ============================================= -->
  
  <context id="M-namespace-separator">
    <error skipuntil="RBRACE" expecting="INIT"/>
    <ignore>
      <type name="comment" />
    </ignore>
    <token type="VBAR" role="vbar" expecting="M-element-name"/>
  </context>
  
  <context id="M-element-name">
    <error skipuntil="RBRACE" expecting="INIT"/>
    <ignore>
      <type name="comment" />
    </ignore>
    <token type="STAR"  role="type" expecting="M-selector-context1"/>
    <token type="IDENT" role="type" expecting="M-selector-context1"/>
  </context>
  
  <context id="M-pseudo-selector">
    <error skipuntil="RBRACE" expecting="INIT"/>
    <token type="COLON"    role="colon-pseudo"    expecting="M-pseudo-selector2"/>
    <token type="FUNCTION" role="pseudo-selector" expecting="M-funcnotation-value2"/>
    <token type="IDENT"    role="pseudo-selector" expecting="M-selector-context1"/>
  </context>
  
  <context id="M-pseudo-selector2">
    <error skipuntil="RBRACE" expecting="INIT"/>
    <token type="IDENT"    role="pseudo-selector" expecting="M-selector-context1"/>
  </context>
  
  <context id="M-funcnotation-value2">
    <error skipuntil="RBRACE" expecting="INIT"/>
    <ignore>
      <type name="whitespace" />
      <type name="comment" />
    </ignore>
    <token type="RPAREN"    role="end-pseudo-selector" expecting="M-selector-context2"/>
    <token type=""          role="funcnotation-value"  expecting="M-funcnotation-value"/>
  </context>
  
  <context id="M-class-selector">
    <error skipuntil="RBRACE" expecting="INIT"/>
    <token type="IDENT" role="class-selector" expecting="M-selector-context1"/>
  </context>
  
  <context id="M-attribute-selector">
    <error skipuntil="RBRACE" expecting="INIT"/>
    <ignore>
      <type name="whitespace" />
      <type name="comment" />
    </ignore>
    <token type="IDENT" lookahead="VBAR" role="namespace"      expecting="M-attr-namespace-separator"/>
    <token type="IDENT"                  role="attribute-name" expecting="M-attribute-context1"/>
    <token type="STAR"  lookahead="VBAR" role="namespace"      expecting="M-attr-namespace-separator"/>
    <token type="STAR"                   role="attribute-name" expecting="M-attribute-context1"/>
    <token type="VBAR"                   role="VBAR"           expecting="M-attribute-name"/>
  </context>
  
  <context id="M-attr-namespace-separator">
    <error skipuntil="RBRACE" expecting="INIT"/>
    <token type="VBAR" role="vbar" expecting="M-attribute-name"/>
  </context>

  <context id="M-attribute-name">
    <error skipuntil="RBRACE" expecting="INIT"/>
    <token type="IDENT" role="attribute-name" expecting="M-attribute-context1"/>
  </context>

  <context id="M-attribute-context1">
    <error skipuntil="RBRACE" expecting="INIT"/>
    <ignore>
      <type name="whitespace" />
      <type name="comment" />
    </ignore>
    <token type="RBRACKET"      role="closebracket"       expecting="M-selector-context1"/>
    <token type="EQUALS"        role="attribute-matching" expecting="M-attribute-value"/>
    <token type="INCLUDES"      role="attribute-matching" expecting="M-attribute-value"/>
    <token type="DASHMATCH"     role="attribute-matching" expecting="M-attribute-value"/>
    <token type="CIRCMATCH"     role="attribute-matching" expecting="M-attribute-value"/>
    <token type="DOLLARMATCH"   role="attribute-matching" expecting="M-attribute-value"/>
    <token type="STARMATCH"     role="attribute-matching" expecting="M-attribute-value"/>
  </context>
  
  <context id="M-attribute-value">
    <error skipuntil="RBRACE" expecting="INIT"/>
    <ignore>
      <type name="whitespace" />
      <type name="comment" />
    </ignore>
    <token type="IDENT"  role="attribute-value" expecting="M-end-attribute-selector"/>
    <token type="STRING" role="attribute-value" expecting="M-end-attribute-selector"/>
  </context>
  
  <context id="M-end-attribute-selector">
    <error skipuntil="RBRACE" expecting="INIT"/>
    <ignore>
      <type name="whitespace" />
      <type name="comment" />
    </ignore>
    <token type="RBRACKET"  role="closebracket"       expecting="M-selector-context1"/>
  </context>
  
  <context id="M-selector-context1">
    <error skipuntil="RBRACE" expecting="INIT"/>
    <ignore>
      <type name="comment" />
    </ignore>
  
    <token type="whitespace"                      expecting="M-selector-context2"/>
    <token type="GREATER"     role="combinator"   expecting="M-selector-context3"/>
    <token type="PLUS"        role="combinator"   expecting="M-selector-context3"/>
    <token type="TILDA"       role="combinator"   expecting="M-selector-context3"/>
  
    <token type="LBRACE"      role="openbrace"    expecting="M-declaration-context1"/>
    <token type="COMMA"       role="grouping"     expecting="M-selector-context3"/>
  
    <token type="COLON"       role="colon-pseudo" expecting="M-pseudo-selector"/>
    <token type="PERIOD"      role="period-class" expecting="M-class-selector"/>
    <token type="LBRACKET"    role="openbracket"  expecting="M-attribute-selector"/>
    <token type="HASHMATCH"   role="ID"           expecting="M-selector-context1"/>
  </context>
  
  <context id="M-selector-context2">
    <error skipuntil="RBRACE" expecting="INIT"/>
    <ignore>
      <type name="whitespace" />
      <type name="comment" />
    </ignore>

    <token type="LBRACE"      role="openbrace"    expecting="M-declaration-context1"/>

    <token type="GREATER"     role="combinator"   expecting="M-selector-context3"/>
    <token type="PLUS"        role="combinator"   expecting="M-selector-context3"/>
    <token type="TILDA"       role="combinator"   expecting="M-selector-context3"/>
  
    <token type="IDENT"  lookahead="VBAR"     role="namespace" expecting="M-namespace-separator"/>
    <token type="IDENT"                       role="type"      expecting="M-selector-context1"/>
    <token type="STAR"   lookahead="VBAR"     role="type"      expecting="M-namespace-separator"/>
    <token type="STAR"                        role="type"      expecting="M-selector-context1"/>
    <token type="VBAR"                        role="vbar"      expecting="M-element-name"/>
    <token type="COLON"                       role="colon-pseudo" expecting="M-pseudo-selector"/>
    <token type="PERIOD"                      role="period-class" expecting="M-class-selector"/>
    <token type="LBRACKET"                    role="openbracket" expecting="M-attribute-selector"/>
    <token type="HASHMATCH"                   role="ID"        expecting="M-selector-context1"/>
  </context>
  
  <context id="M-selector-context3">
    <error skipuntil="RBRACE" expecting="INIT"/>
    <ignore>
      <type name="whitespace" />
      <type name="comment" />
    </ignore>
  
    <token type="IDENT"  lookahead="VBAR"     role="namespace" expecting="M-namespace-separator"/>
    <token type="IDENT"                       role="type"      expecting="M-selector-context1"/>
    <token type="STAR"   lookahead="VBAR"     role="type"      expecting="M-namespace-separator"/>
    <token type="STAR"                        role="type"      expecting="M-selector-context1"/>
    <token type="VBAR"                        role="vbar"      expecting="M-element-name"/>
    <token type="COLON"                       role="colon-pseudo" expecting="M-pseudo-selector"/>
    <token type="PERIOD"                      role="period-class" expecting="M-class-selector"/>
    <token type="LBRACKET"                    role="openbracket" expecting="M-attribute-selector"/>
    <token type="HASHMATCH"                   role="ID"        expecting="M-selector-context1"/>
  </context>
  
  
  <!-- ============================================= -->
  <!-- DECLARATIONS IN MEDIA AT-RULE -->
  <!-- ============================================= -->
  
  <context id="M-declaration-context1">
    <error skipuntil="SEMICOLON" expecting="M-declaration-context1"/>
    <ignore>
      <type name="whitespace" />
      <type name="comment" />
    </ignore>
    <token type="SEMICOLON"    role="semicolon" expecting="M-declaration-context1"/>
    <token type="IDENT"        role="property"  expecting="M-declaration-separator"/>
    <token type="RBRACE"       role="closebrace" expecting="style-rule-only"/>
  </context>
  
  <context id="M-declaration-separator">
    <ignore>
      <type name="whitespace" />
      <type name="comment" />
    </ignore>
    <token type="COLON"  role="colon" expecting="M-declaration-value1"/>
  </context>
  
  <context id="M-declaration-value1">
    <ignore>
      <type name="whitespace" />
      <type name="comment" />
    </ignore>
    <token type="PERCENTAGE" role="value" expecting="M-declaration-value2"/>
    <token type="DIMENSION"  role="value" expecting="M-declaration-value2"/>
    <token type="NUMBER"     role="value" expecting="M-declaration-value2"/>
    <token type="HASHMATCH"  role="value" expecting="M-declaration-value2"/>
    <token type="URI"        role="url-call" expecting="M-declaration-url-value"/>
    <token type="STRING"     role="value" expecting="M-declaration-value2"/>
    <token type="FUNCTION"   role="function-call" expecting="M-function-value1"/>
    <token type="IDENT"      role="value" expecting="M-declaration-value2"/>
  </context>

  <context id="M-declaration-url-value">
    <ignore>
      <type name="whitespace" />
      <type name="comment" />
    </ignore>
    <token type="STRING"  role="url-value" expecting="M-declaration-rule-url-rparen"/>
    <token type="URL"     role="url-value" expecting="M-declaration-rule-url-rparen"/>
  </context>

  <context id="M-declaration-rule-url-rparen">
    <ignore>
      <type name="whitespace" />
      <type name="comment" />
    </ignore>
    <token type="RPAREN"  role="url-call" expecting="M-declaration-value2"/>
  </context>

  <context id="M-declaration-value2">
    <ignore>
      <type name="whitespace" />
      <type name="comment" />
    </ignore>
    <token type="SEMICOLON"  role="semicolon"  expecting="M-declaration-context1"/>
    <token type="RBRACE"     role="closebrace" expecting="style-rule-only"/>
  
    <token type="SLASH"      role="slash" expecting="M-declaration-value1"/>
    <token type="COMMA"      role="valuedelimiter" expecting="M-declaration-value1"/>
  
    <token type="PERCENTAGE" role="value" expecting="M-declaration-value2"/>
    <token type="DIMENSION"  role="value" expecting="M-declaration-value2"/>
    <token type="NUMBER"     role="value" expecting="M-declaration-value2"/>
    <token type="HASHMATCH"  role="value" expecting="M-declaration-value2"/>
    <token type="URI"        role="url-call" expecting="M-declaration-url-value"/>
    <token type="STRING"     role="value" expecting="M-declaration-value2"/>
    <token type="FUNCTION"   role="function-call" expecting="M-function-value1"/>
    <token type="IDENT"      role="value" expecting="M-declaration-value2"/>
  </context>
  
  <context id="M-function-value1">
    <ignore>
      <type name="whitespace" />
      <type name="comment" />
    </ignore>
    <token type="RPAREN"    role="function-call" expecting="M-declaration-value2"/>
    <token type=""          role="function-value"     expecting="M-function-value1"/>
  </context>

</grammar>
